<!doctype html>
<html>
<head>
    <title>vue.js textbox component</title>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<h1>Autocomplete Vue.js textbox component</h1>
<div id="app">
    <autocomplete
            :place-holder-text="placeHolderInputText"
            :result-items="autoCompleteResult"
            :on-key-up="onKeyUpAutoCompleteEvent"
            :on-selected="onSelectedAutoCompleteEvent"
            :auto-complete-progress="autoCompleteProgress"
            :item-text="autoCompleteText"
            :item-id="autoCompleteFieldId">
    </autocomplete>

    <div class="wrapper" v-if="seen">
        <div class="card">
            <img :src="'images/' + item.image">
            {{ item.name }} ({{ item.calorie}})
            <ul v-if="item.ingredients.length > 0">
                <li v-for="(ingredients,i) in item.ingredients" :key="i">
                    {{ ingredients }}
                </li>
            </ul>
        </div>
    </div>

</div>

<script>
    const suggestions = [
        { id: 1, name: 'Coke', calorie: '20', ingredients: ['Sugar', 'Caffeine', 'Caramel color'], image: 'coke.png'},
        { id: 2, name: 'Fries', calorie: '30', ingredients: ['Potatoes', 'Vegetable oil', 'Eggs'], image: 'fries.jpg'},
        { id: 3, name: 'Pizza', calorie: '50', ingredients: ['Cheese', 'Dough', 'Mozzarella'], image: 'pizza.jpg'},
        ];
    var autoCompleteComponent = Vue.component('autocomplete', {
        props: {
            placeHolderText: String,
            onKeyUp: Function,
            onSelected: Function,
            resultItems: Array,
            autoCompleteProgress: Boolean,
            itemText: String,
            itemId: String,
        },

        data() {
            return {
                keywordSearch: ''
            }
        },

        template: `
		<div class="autocomplete">
			<input type="text" :placeholder="placeHolderText" v-model="keywordSearch" class="form-textinput" :class="{ 'loading-circle' : (keywordSearch.length > 2), 'hide-loading-circle': resultItems.length > 0 || resultItems.length == 0 && !autoCompleteProgress  }" @keyup="!autoCompleteProgress ? onKeyUp(keywordSearch) : ''"/>
			<ul class="autocomplete-results" v-if="resultItems.length > 0">
				<li class="autocomplete-result" v-for="(item,i) in resultItems" :key="i" @click="keywordSearch='';onSelected(item[itemId])">
					{{ item[itemText] }}
				</li>
			</ul>
		</div>
	`
    });

    var app = new Vue({
        el: '#app',
        data: {
            placeHolderInputText: 'Enter food name',
            autoCompleteResult: [],
            autoCompleteProgress: false,
            autoCompleteText: "name",
            autoCompleteFieldId: "id",
            seen: false,
            item: '',
        },
        methods: {
            onSelectedAutoCompleteEvent(id){
                var searchItem = suggestions.find(function (elem) {
                    return elem.id == id;
                });
                this.autoCompleteProgress = false;
                this.autoCompleteResult = [];
                this.item = searchItem;
                this.seen = true;
            },

            onKeyUpAutoCompleteEvent(keywordEntered){
                //reset
                this.autoCompleteResult = [];
                this.autoCompleteProgress = false;
                if(keywordEntered.length > 2){
                    var newData = [];
                    suggestions.forEach(function(item, index){
                        if(item.name.toLowerCase().indexOf(keywordEntered.toLowerCase()) >= 0){
                            newData.push(item);
                        }
                    });
                    this.autoCompleteResult = newData;
                    this.autoCompleteProgress = false;
                }else{
                    this.autoCompleteProgress = false;
                    this.autoCompleteResult = [];
                }
            },
        }
    })
</script>